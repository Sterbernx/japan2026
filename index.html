<!DOCTYPE html>
<html lang="pl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <title>üáØüáµ JAPONIA V8 GOD MODE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300;400;600&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        neonPink: '#ff0055',
                        neonCyan: '#00f2ff',
                        neonGold: '#ffd700',
                        neonPurple: '#bc13fe',
                        neonGreen: '#39ff14',
                        bgBlack: '#050505',
                        bgCard: '#111111'
                    },
                    fontFamily: {
                        'teko': ['Teko', 'sans-serif'],
                        'inter': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; -webkit-tap-highlight-color: transparent; }
        
        /* Fix Mapy */
        #map { height: 100%; width: 100%; z-index: 1; background: #000; }
        .leaflet-tile-pane { filter: invert(100%) hue-rotate(180deg) brightness(85%) contrast(110%); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Ikony mapy */
        .number-icon {
            background: rgba(0,0,0,0.9); border: 2px solid #00f2ff; color: #00f2ff;
            border-radius: 50%; text-align: center; font-weight: 800; font-size: 16px; line-height: 28px;
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.4);
        }
        .hotel-icon {
            background: #ff0055; border: 2px solid #fff; color: #fff;
            border-radius: 8px; text-align: center; font-size: 20px; line-height: 30px; z-index: 999;
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.6);
        }
        
        /* Animacje */
        .tab-content { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body class="h-screen flex flex-col overflow-hidden bg-bgBlack" x-data="travelApp()" x-init="initApp()">

    <header class="flex-none bg-bgCard border-b border-gray-800 p-3 flex justify-between items-center z-20 shadow-lg">
        <div class="flex items-center gap-2">
            <span class="text-2xl">üáØüáµ</span>
            <div>
                <h1 class="font-teko text-2xl tracking-widest text-white leading-none">GOD MODE</h1>
                <div class="text-[10px] text-neonCyan font-bold tracking-widest" x-text="currentTime"></div>
            </div>
        </div>
        <div class="text-right">
             <div class="text-[9px] text-gray-400 font-bold uppercase">Do Wylotu</div>
             <div class="font-teko text-xl text-neonPink animate-pulse" x-text="countdownStr"></div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto bg-black relative z-10 no-scrollbar pb-24">
        
        <div x-show="activeTab === 'dash'" class="p-4 space-y-4 tab-content">
            
            <div class="grid grid-cols-2 gap-3">
                <button @click="activeTab = 'splitter'" class="bg-gray-900 border border-gray-700 p-4 rounded-xl flex flex-col items-center hover:border-neonGreen transition-colors">
                    <span class="text-3xl mb-1">üí∏</span>
                    <span class="text-xs font-bold text-gray-300">ROZLICZ HAJS</span>
                </button>
                <button @click="activeTab = 'sos'" class="bg-gray-900 border border-gray-700 p-4 rounded-xl flex flex-col items-center hover:border-red-500 transition-colors">
                    <span class="text-3xl mb-1">üÜò</span>
                    <span class="text-xs font-bold text-gray-300">RATUNEK</span>
                </button>
            </div>

            <div class="bg-[#111] rounded-2xl p-5 border border-neonCyan/30 shadow-[0_0_15px_rgba(0,242,255,0.1)]">
                <h3 class="text-neonCyan font-bold mb-3 text-sm tracking-wider">üí¥ SZYBKI PRZELICZNIK</h3>
                <div class="flex gap-2 items-center">
                    <div class="flex-1">
                        <input type="number" x-model="yenInput" placeholder="JPY" class="w-full bg-black border border-gray-700 rounded p-3 text-white font-mono text-lg focus:border-neonCyan outline-none text-center">
                    </div>
                    <div class="text-gray-500">‚ûú</div>
                    <div class="flex-1">
                        <div class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-neonGold font-mono font-bold text-lg text-center" x-text="convertedPln"></div>
                    </div>
                </div>
            </div>

            <div class="bg-[#111] rounded-2xl p-5 border border-neonPurple/30">
                <h3 class="text-neonPurple font-bold mb-3 text-sm tracking-wider">üó£Ô∏è M√ìWIƒÑCE ROZM√ìWKI</h3>
                <div class="space-y-3">
                    <template x-for="phrase in phrases">
                        <div class="flex justify-between items-center border-b border-gray-800 pb-2 last:border-0">
                            <div>
                                <div class="text-sm text-white font-bold" x-text="phrase.pl"></div>
                                <div class="text-[10px] text-gray-500 italic" x-text="phrase.pron"></div>
                            </div>
                            <button @click="speak(phrase.jp)" class="bg-neonPurple/20 text-neonPurple border border-neonPurple/50 px-3 py-1 rounded-full text-xs font-bold hover:bg-neonPurple hover:text-white transition-colors flex items-center gap-1">
                                üîä <span x-text="phrase.label || 'M√≥w'"></span>
                            </button>
                        </div>
                    </template>
                </div>
            </div>

            <div class="bg-[#111] rounded-2xl p-5 border border-gray-700">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-gray-300 font-bold text-sm tracking-wider">üéí PAMIƒòTAJ ZABRAƒÜ</h3>
                    <span class="text-xs text-neonGreen" x-text="packedCount + '/' + checklist.length"></span>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <template x-for="(item, index) in checklist">
                        <div @click="togglePack(index)" class="cursor-pointer p-2 rounded border text-xs font-bold flex items-center gap-2 transition-all"
                             :class="item.done ? 'bg-neonGreen/10 border-neonGreen text-neonGreen' : 'bg-gray-900 border-gray-700 text-gray-500'">
                            <span x-text="item.done ? '‚úÖ' : '‚¨ú'"></span>
                            <span x-text="item.name"></span>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <div x-show="activeTab === 'plan'" class="flex flex-col h-full tab-content">
            <div class="flex-none relative bg-black z-0 h-[40vh] border-b border-gray-800 w-full">
                <div id="map"></div>
                <div class="absolute bottom-2 right-2 z-[500] flex gap-2">
                    <button @click="locateMe()" class="bg-black/80 p-2 rounded border border-white text-white text-xs">üìç Gdzie ja jestem?</button>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-2 pb-24">
                <template x-for="(day, index) in allDays" :key="day.id">
                    <div class="mb-3 bg-bgCard rounded-xl border border-gray-800 overflow-hidden">
                        
                        <div @click="focusDay(day)" 
                             class="p-4 flex justify-between items-center cursor-pointer transition-colors hover:bg-white/5 border-l-4"
                             :class="day.colorClass">
                            <div>
                                <div class="font-teko text-xl text-white" x-text="day.date"></div>
                                <div class="text-[10px] text-gray-400 font-bold uppercase tracking-widest" x-text="day.title"></div>
                            </div>
                            <div class="text-neonCyan transform transition-transform" :class="currentDayId === day.id ? 'rotate-90' : ''">‚û§</div>
                        </div>

                        <div x-show="currentDayId === day.id" class="border-t border-gray-800 bg-black/50 p-2 space-y-2">
                            <div class="text-[10px] text-gray-500 flex items-center gap-2 p-1 bg-gray-900 rounded">
                                <span>üè® Baza:</span> <span class="text-neonPink font-bold" x-text="hotels[day.hotelKey].name"></span>
                            </div>

                            <template x-for="(task, i) in day.tasks" :key="task.name">
                                <div class="bg-[#1a1a1a] rounded p-3 relative group border border-gray-800/50">
                                    <div class="flex justify-between items-start">
                                        <div class="flex gap-3">
                                            <div class="flex-none w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs border border-gray-600 text-gray-400" x-text="i + 1"></div>
                                            <div>
                                                <div class="text-sm font-bold text-gray-200" :class="isChecked(task.name) ? 'line-through opacity-50' : ''" x-text="task.name"></div>
                                                <div class="text-[10px] text-neonCyan mt-1">üöá <span x-text="task.transport"></span></div>
                                            </div>
                                        </div>
                                        <input type="checkbox" class="w-5 h-5 accent-neonCyan rounded cursor-pointer" :checked="isChecked(task.name)" @change="toggleCheck(task.name)">
                                    </div>
                                    <div class="mt-2 flex gap-2">
                                        <a x-show="task.coords" :href="`https://www.google.com/maps/dir/?api=1&destination=${task.coords[0]},${task.coords[1]}&travelmode=transit`" target="_blank" 
                                           class="bg-gray-800 px-3 py-1 rounded text-[10px] text-white border border-gray-600">üìç Mapa</a>
                                        <button x-show="task.food" @click="alert('Polecajka: ' + task.food)" class="bg-gray-800 px-3 py-1 rounded text-[10px] text-neonGold border border-gray-600">üçî ≈ªarcie</button>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <div x-show="activeTab === 'splitter'" class="p-4 space-y-4 tab-content h-full flex flex-col">
            <h2 class="font-teko text-3xl text-neonGreen mb-2">ROZLICZACZ üí∞</h2>
            
            <div class="bg-gray-900 p-4 rounded-xl border border-gray-700">
                <div class="grid grid-cols-3 gap-2 mb-2">
                    <input x-model="newExpense.who" list="users" placeholder="Kto?" class="bg-black p-2 rounded border border-gray-600 text-white text-sm">
                    <datalist id="users"><option value="Aleks"><option value="Ziomek 1"><option value="Ziomek 2"></datalist>
                    <input type="number" x-model="newExpense.amount" placeholder="Ile (JPY)" class="bg-black p-2 rounded border border-gray-600 text-white text-sm col-span-2">
                </div>
                <input x-model="newExpense.desc" placeholder="Za co? (np. browary)" class="w-full bg-black p-2 rounded border border-gray-600 text-white text-sm mb-3">
                <button @click="addExpense()" class="w-full bg-neonGreen text-black font-bold py-2 rounded uppercase tracking-wider hover:bg-white transition">Dodaj Wydatek</button>
            </div>

            <div class="flex-1 overflow-y-auto bg-[#111] rounded-xl border border-gray-800 p-2">
                <template x-for="(exp, index) in expenses">
                    <div class="flex justify-between items-center p-2 border-b border-gray-800 text-sm">
                        <div>
                            <span class="font-bold text-white" x-text="exp.who"></span>
                            <span class="text-gray-500 mx-1">zap≈Çaci≈Ç</span>
                            <span class="text-neonGreen font-mono" x-text="exp.amount"></span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-gray-400 truncate w-20 text-right" x-text="exp.desc"></span>
                            <button @click="removeExpense(index)" class="text-red-500 text-xs">‚úï</button>
                        </div>
                    </div>
                </template>
            </div>
            
             <div class="bg-gray-900 p-3 rounded-xl text-center">
                 <div class="text-xs text-gray-400">SUMA WYDATK√ìW</div>
                 <div class="text-2xl font-mono text-white" x-text="totalExpenses + ' JPY'"></div>
             </div>
        </div>

        <div x-show="activeTab === 'sos'" class="p-4 space-y-6 tab-content text-center">
            <h2 class="font-teko text-4xl text-red-600 animate-pulse">EMERGENCY üÜò</h2>
            
            <div class="space-y-4">
                <div class="p-4 bg-red-900/20 border border-red-600 rounded-xl">
                    <div class="text-xs text-red-400 uppercase font-bold">Policja</div>
                    <div class="text-3xl font-bold text-white">110</div>
                </div>
                <div class="p-4 bg-red-900/20 border border-red-600 rounded-xl">
                    <div class="text-xs text-red-400 uppercase font-bold">Pogotowie / Stra≈º</div>
                    <div class="text-3xl font-bold text-white">119</div>
                </div>
            </div>

            <div class="bg-white text-black p-4 rounded-xl text-left shadow-lg">
                <h3 class="font-bold text-lg mb-2 border-b border-gray-300 pb-1">üöñ Dla Taks√≥wkarza</h3>
                <p class="text-xl font-bold mb-1">Koko made onegaishimasu:</p>
                <p class="text-sm text-gray-600 italic">(Proszƒô zawie≈∫ƒá mnie tutaj)</p>
                <div class="mt-3 bg-gray-100 p-2 rounded border border-gray-300">
                    <p class="font-bold text-lg">Hotel Galicia Ryogoku</p>
                    <p class="text-sm">4-31-6 Ryogoku, Sumida-ku, Tokyo</p>
                </div>
            </div>

            <div class="text-xs text-gray-500 mt-10">
                Ambasada RP w Tokio: 2-13-5 Mita, Meguro-ku<br>
                Tel: +81 3 5794 7020
            </div>
        </div>

    </main>

    <nav class="flex-none bg-black border-t border-gray-800 pb-safe z-50">
        <div class="flex justify-around items-center h-16">
            <button @click="activeTab = 'dash'" :class="activeTab === 'dash' ? 'text-white scale-110' : 'text-gray-600'" class="flex flex-col items-center w-1/4 transition-all">
                <span class="text-xl">üè†</span><span class="text-[9px] font-bold mt-1">START</span>
            </button>
            <button @click="activeTab = 'plan'" :class="activeTab === 'plan' ? 'text-neonCyan scale-110' : 'text-gray-600'" class="flex flex-col items-center w-1/4 transition-all">
                <span class="text-xl">üó∫Ô∏è</span><span class="text-[9px] font-bold mt-1">PLAN</span>
            </button>
            <button @click="activeTab = 'splitter'" :class="activeTab === 'splitter' ? 'text-neonGreen scale-110' : 'text-gray-600'" class="flex flex-col items-center w-1/4 transition-all">
                <span class="text-xl">üí∏</span><span class="text-[9px] font-bold mt-1">HAJS</span>
            </button>
            <button @click="activeTab = 'sos'" :class="activeTab === 'sos' ? 'text-red-500 scale-110' : 'text-gray-600'" class="flex flex-col items-center w-1/4 transition-all">
                <span class="text-xl">üÜò</span><span class="text-[9px] font-bold mt-1">HELP</span>
            </button>
        </div>
    </nav>

    <script>
        function travelApp() {
            return {
                activeTab: 'dash', 
                map: null, markers: [], routeLine: null,
                currentDayId: 'd1',
                currentTime: '',
                countdownStr: '',
                yenInput: '',
                
                // DATA
                checked: JSON.parse(localStorage.getItem('jp_v8_checked')) || [],
                expenses: JSON.parse(localStorage.getItem('jp_v8_expenses')) || [],
                checklist: JSON.parse(localStorage.getItem('jp_v8_pack')) || [
                    {name: 'Paszport', done: false}, {name: 'Powerbank', done: false}, 
                    {name: 'Adapter JP', done: false}, {name: 'Skarpetki', done: false},
                    {name: 'Bielizna', done: false}, {name: 'Leki', done: false},
                    {name: 'Hajs (YEN)', done: false}, {name: 'Ubezpieczenie', done: false}
                ],
                newExpense: { who: '', amount: '', desc: '' },

                hotels: {
                    [cite_start]'galicia': { name: 'Galicia Ryogoku [cite: 4]', coords: [35.6930, 139.7924] },
                    [cite_start]'lion': { name: 'Le Lion d\'or [cite: 50]', coords: [35.0080, 135.7700] },
                    [cite_start]'tomi': { name: 'TOMI Hotel [cite: 74]', coords: [35.6650, 139.8700] }
                },

                // Itinerary based on user provided PDF
                allDays: [
                    { id: 'd1', date: '23.03', title: 'ASAKUSA', hotelKey: 'galicia', colorClass: 'border-neonPink', tasks: [
                        { name: 'Sens≈ç-ji', coords: [35.7147, 139.7966], transport: 'Spacer', food: 'Melonpan' },
                        [cite_start]{ name: 'Park Ueno [cite: 13]', coords: [35.7140, 139.7740], transport: 'Ginza Line', food: 'Street food' },
                        [cite_start]{ name: 'Daikoku-yu Onsen [cite: 12]', coords: [35.7077, 139.8056], transport: 'Taxi', food: 'Mleko' }
                    ]},
                    { id: 'd2', date: '24.03', title: 'CENTRUM', hotelKey: 'galicia', colorClass: 'border-neonPink', tasks: [
                        [cite_start]{ name: 'Tsukiji Market [cite: 18]', coords: [35.6654, 139.7706], transport: 'Oedo Line', food: 'Sushi' },
                        [cite_start]{ name: 'Akihabara [cite: 21]', coords: [35.7022, 139.7741], transport: 'Yamanote', food: 'Maid Cafe' }
                    ]},
                    { id: 'd3', date: '25.03', title: 'WEST (HARD)', hotelKey: 'galicia', colorClass: 'border-red-500', tasks: [
                        [cite_start]{ name: 'Gotokuji [cite: 25]', coords: [35.6482, 139.6483], transport: 'Odakyu', food: '-' },
                        [cite_start]{ name: 'Shibuya Crossing [cite: 27]', coords: [35.6595, 139.7004], transport: 'Inokashira', food: 'Genki Sushi' }
                    ]},
                    { id: 'd4', date: '26.03', title: 'CHILL', hotelKey: 'galicia', colorClass: 'border-neonPink', tasks: [
                        [cite_start]{ name: 'Nakameguro [cite: 39]', coords: [35.6443, 139.6990], transport: 'Hibiya', food: 'Szampan' },
                        [cite_start]{ name: 'Shinjuku [cite: 33]', coords: [35.6938, 139.7035], transport: 'Yamanote', food: 'Yakitori' }
                    ]},
                    { id: 'd5', date: '27.03', title: 'TRIP', hotelKey: 'galicia', colorClass: 'border-neonGold', tasks: [
                        [cite_start]{ name: 'Kamakura [cite: 42]', coords: [35.3168, 139.5361], transport: 'JR', food: 'Lody' },
                        [cite_start]{ name: 'Enoshima [cite: 43]', coords: [35.3016, 139.4814], transport: 'Enoden', food: 'Ryby' }
                    ]},
                    { id: 'd6', date: '28.03', title: 'KIOTO START', hotelKey: 'lion', colorClass: 'border-neonPurple', tasks: [
                        [cite_start]{ name: 'Kiyomizu-dera [cite: 52]', coords: [34.9948, 135.7850], transport: 'Taxi', food: 'Yatsuhashi' },
                        [cite_start]{ name: 'Gion [cite: 54]', coords: [35.0054, 135.7745], transport: 'Spacer', food: 'Kaiseki' }
                    ]},
                    { id: 'd7', date: '29.03', title: 'INARI', hotelKey: 'lion', colorClass: 'border-neonPurple', tasks: [
                        [cite_start]{ name: 'Fushimi Inari [cite: 58]', coords: [34.9671, 135.7726], transport: 'Keihan', food: 'Udon' }
                    ]},
                    { id: 'd9', date: '31.03', title: 'NARA', hotelKey: 'lion', colorClass: 'border-neonPurple', tasks: [
                        [cite_start]{ name: 'Nara Park [cite: 66]', coords: [34.6850, 135.8430], transport: 'Kintetsu', food: 'Mochi' }
                    ]},
                    { id: 'd10', date: '01.04', title: 'POWR√ìT', hotelKey: 'tomi', colorClass: 'border-neonCyan', tasks: [
                        [cite_start]{ name: 'Check-in TOMI [cite: 74]', coords: [35.6650, 139.8700], transport: 'Taxi', food: '-' },
                        [cite_start]{ name: 'Zakupy [cite: 80]', coords: null, transport: 'Wszƒôdzie', food: 'KitKat' }
                    ]}
                ],

                phrases: [
                    { pl: 'Dziƒôkujƒô', jp: 'Arigatou gozaimasu', pron: 'Arigato gozajmas', label: 'Arigatou' },
                    { pl: 'Przepraszam', jp: 'Sumimasen', pron: 'Sumimasen', label: 'Sumimasen' },
                    { pl: 'Piwo poproszƒô', jp: 'Biru o kudasai', pron: 'Biru o kudasaj', label: 'Piwo' },
                    { pl: 'Rachunek', jp: 'Okaikei onegaishimasu', pron: 'Okajke', label: 'Rachunek' },
                    { pl: 'Toaleta?', jp: 'Toire wa doko desu ka?', pron: 'Tojre ≈Ça doko', label: 'Kibel' },
                    { pl: 'Nie rozumiem', jp: 'Wakarimasen', pron: '≈Åakarimasen', label: '???' }
                ],

                // COMPUTED
                get convertedPln() { return this.yenInput ? (this.yenInput * 0.027).toFixed(2) + ' z≈Ç' : '0.00 z≈Ç'; },
                get totalExpenses() { return this.expenses.reduce((sum, item) => sum + parseInt(item.amount || 0), 0); },
                get packedCount() { return this.checklist.filter(i => i.done).length; },

                initApp() {
                    // Zegar
                    setInterval(() => {
                        const now = new Date();
                        this.currentTime = now.toLocaleTimeString('pl-PL', {hour: '2-digit', minute:'2-digit'});
                        // Countdown
                        const tripDate = new Date('2026-03-22T20:00:00');
                        const diff = tripDate - now;
                        if(diff > 0) {
                            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                            this.countdownStr = `${d} DNI`;
                        } else this.countdownStr = "TRIP TRWA!";
                    }, 1000);

                    // FIX MAPY - Watcher
                    this.$watch('activeTab', (val) => {
                        if(val === 'plan') {
                            // Czekamy chwilƒô a≈º div siƒô pojawi (display: block) i wtedy renderujemy mapƒô
                            setTimeout(() => {
                                if(!this.map) this.initMap();
                                else this.map.invalidateSize(); // TO JEST KLUCZOWE!
                                this.focusDay(this.allDays[0]);
                            }, 150);
                        }
                    });
                },

                // MAP LOGIC
                initMap() {
                    this.map = L.map('map', {zoomControl: false}).setView([35.6930, 139.7924], 12);
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { maxZoom: 19 }).addTo(this.map);
                },

                focusDay(day) {
                    this.currentDayId = day.id;
                    if(!this.map) return;
                    
                    // Reset
                    this.markers.forEach(m => this.map.removeLayer(m));
                    if(this.routeLine) this.map.removeLayer(this.routeLine);
                    this.markers = [];
                    
                    const hotel = this.hotels[day.hotelKey];
                    const points = [hotel.coords];
                    
                    // Hotel Pin
                    this.markers.push(L.marker(hotel.coords, {icon: L.divIcon({html: '<div class="hotel-icon">üè®</div>', iconSize:[30,30]})}).addTo(this.map));

                    // Task Pins
                    day.tasks.forEach((t, i) => {
                        if(t.coords) {
                            points.push(t.coords);
                            this.markers.push(L.marker(t.coords, {icon: L.divIcon({html: `<div class="number-icon">${i+1}</div>`, iconSize:[28,28]})}).addTo(this.map));
                        }
                    });

                    // Line
                    if(points.length > 1) {
                        this.routeLine = L.polyline(points, {color: '#00f2ff', weight: 4, opacity:0.8}).addTo(this.map);
                        this.map.flyToBounds(L.latLngBounds(points), {padding:[30,30], duration:0.5});
                    }
                },
                
                locateMe() {
                    if(navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(pos => {
                            L.marker([pos.coords.latitude, pos.coords.longitude]).addTo(this.map).bindPopup("TY").openPopup();
                            this.map.setView([pos.coords.latitude, pos.coords.longitude], 14);
                        });
                    } else alert("W≈ÇƒÖcz GPS!");
                },

                // ACTIONS
                speak(text) {
                    const u = new SpeechSynthesisUtterance(text);
                    u.lang = 'ja-JP';
                    window.speechSynthesis.speak(u);
                },
                
                addExpense() {
                    if(this.newExpense.amount && this.newExpense.who) {
                        this.expenses.push({...this.newExpense});
                        this.newExpense = {who: '', amount: '', desc: ''};
                        localStorage.setItem('jp_v8_expenses', JSON.stringify(this.expenses));
                    }
                },
                removeExpense(i) {
                    this.expenses.splice(i, 1);
                    localStorage.setItem('jp_v8_expenses', JSON.stringify(this.expenses));
                },
                
                togglePack(i) {
                    this.checklist[i].done = !this.checklist[i].done;
                    localStorage.setItem('jp_v8_pack', JSON.stringify(this.checklist));
                },

                isChecked(name) { return this.checked.includes(name); },
                toggleCheck(name) {
                    if(this.checked.includes(name)) this.checked = this.checked.filter(i=>i!==name);
                    else { this.checked.push(name); if(navigator.vibrate) navigator.vibrate(50); }
                    localStorage.setItem('jp_v8_checked', JSON.stringify(this.checked));
                }
            }
        }
    </script>
</body>
</html>

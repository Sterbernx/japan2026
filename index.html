<!DOCTYPE html>
<html lang="pl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <title>üáØüáµ JAPONIA V7 CYBER</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300;400;600&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        neonPink: '#ff0055',
                        neonCyan: '#00f2ff',
                        neonGold: '#ffd700',
                        neonPurple: '#bc13fe',
                        bgBlack: '#050505',
                        bgCard: '#111111'
                    },
                    fontFamily: {
                        'teko': ['Teko', 'sans-serif'],
                        'inter': ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; -webkit-tap-highlight-color: transparent; }
        
        /* Mapa */
        #map { height: 35vh; width: 100%; z-index: 1; border-bottom: 1px solid #333; }
        .leaflet-tile-pane { filter: invert(100%) hue-rotate(180deg) brightness(85%) contrast(110%); }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Ikony mapy */
        .number-icon {
            background: rgba(0,0,0,0.9); border: 2px solid #00f2ff; color: #00f2ff;
            border-radius: 50%; text-align: center; font-weight: 800; font-size: 16px; line-height: 28px;
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.4);
        }
        .hotel-icon {
            background: #ff0055; border: 2px solid #fff; color: #fff;
            border-radius: 8px; text-align: center; font-size: 20px; line-height: 30px; z-index: 999;
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.6);
        }
    </style>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body class="h-screen flex flex-col overflow-hidden bg-bgBlack" x-data="travelApp()" x-init="initApp()">

    <div class="h-1 w-full bg-gray-900 z-50">
        <div class="h-full bg-gradient-to-r from-neonPink via-neonPurple to-neonCyan transition-all duration-700 ease-out shadow-[0_0_10px_#00f2ff]" 
             :style="`width: ${globalProgress}%`"></div>
    </div>

    <header class="flex-none bg-bgCard border-b border-gray-800 p-3 flex justify-between items-center z-20">
        <div>
            <h1 class="font-teko text-2xl tracking-widest text-white leading-none">JAPONIA <span class="text-neonCyan">V7</span></h1>
            <div class="text-[10px] text-gray-500 font-bold tracking-widest" x-text="todayDate"></div>
        </div>
        <div class="text-right">
             <div class="text-xs text-gray-400 font-bold">POSTƒòP</div>
             <div class="font-teko text-xl text-neonCyan" x-text="globalProgress + '%'"></div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto bg-black relative z-10 no-scrollbar pb-24">
        
        <div x-show="activeTab === 'dash'" class="p-4 space-y-6 animate-fade-in">
            
            <div class="bg-gray-900/50 rounded-2xl p-5 border border-gray-800 text-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-neonPink"></div>
                <div class="text-xs text-gray-400 uppercase tracking-widest mb-2">Do Wylotu (22.03.2026) zosta≈Ço:</div>
                <div class="flex justify-center gap-4 font-teko text-4xl text-white">
                    <div>
                        <span x-text="countdown.days"></span><span class="text-sm text-gray-500 block -mt-2">DNI</span>
                    </div>
                    <div>:</div>
                    <div>
                        <span x-text="countdown.hours"></span><span class="text-sm text-gray-500 block -mt-2">GODZ</span>
                    </div>
                </div>
            </div>

            <div class="bg-gray-900/50 rounded-2xl p-5 border border-neonCyan/30">
                <h3 class="text-neonCyan font-bold mb-3 flex items-center gap-2">üí¥ Szybki Przelicznik</h3>
                <div class="flex gap-2 items-center">
                    <div class="flex-1">
                        <label class="text-[10px] text-gray-500">JENY (JPY)</label>
                        <input type="number" x-model="yenInput" placeholder="np. 1000" class="w-full bg-black border border-gray-700 rounded p-2 text-white font-mono focus:border-neonCyan outline-none">
                    </div>
                    <div class="text-2xl text-gray-600">=</div>
                    <div class="flex-1">
                        <label class="text-[10px] text-gray-500">Z≈ÅOTE (PLN)</label>
                        <div class="w-full bg-gray-800 border border-gray-700 rounded p-2 text-neonGold font-mono font-bold" x-text="convertedPln"></div>
                    </div>
                </div>
                <p class="text-[9px] text-gray-600 mt-2 text-center italic">*Kurs orientacyjny 1000 JPY ‚âà 26 PLN</p>
            </div>

            <div class="bg-gray-900/50 rounded-2xl p-5 border border-neonPurple/30">
                <h3 class="text-neonPurple font-bold mb-3">üó£Ô∏è Rozm√≥wki Ratunkowe</h3>
                <div class="space-y-2">
                    <template x-for="phrase in phrases">
                        <div class="flex justify-between items-center border-b border-gray-800 pb-2 last:border-0">
                            <div>
                                <div class="text-sm text-white" x-text="phrase.pl"></div>
                                <div class="text-[10px] text-gray-400 italic" x-text="phrase.pron"></div>
                            </div>
                            <div class="text-neonPurple font-bold text-sm" x-text="phrase.jp"></div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <div x-show="activeTab === 'plan'" class="flex flex-col h-full">
            <div class="flex-none relative bg-black z-0 h-[35vh] border-b border-gray-800">
                <div id="map" class="h-full w-full"></div>
                <div class="absolute bottom-2 left-2 z-[500] bg-black/80 px-2 py-1 rounded border border-neonCyan text-[10px] text-neonCyan">
                    <span x-text="currentDayTitle"></span>
                </div>
            </div>

            <div class="flex-1 overflow-y-auto p-2 pb-24">
                <template x-for="(day, index) in allDays" :key="day.id">
                    <div class="mb-4 bg-bgCard rounded-xl border border-gray-800 overflow-hidden">
                        
                        <div @click="focusDay(day)" 
                             class="p-4 flex justify-between items-center cursor-pointer transition-colors hover:bg-white/5 border-l-4"
                             :class="day.colorClass">
                            <div>
                                <div class="font-teko text-xl text-white" x-text="day.date"></div>
                                <div class="text-[10px] text-gray-400 font-bold uppercase tracking-widest" x-text="day.title"></div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-[9px] bg-gray-800 px-2 py-1 rounded text-gray-300" x-text="day.totalKm ? day.totalKm + ' km' : '-'"></span>
                                <div class="text-neonCyan transform transition-transform" :class="currentDayId === day.id ? 'rotate-90' : ''">‚û§</div>
                            </div>
                        </div>

                        <div x-show="currentDayId === day.id" x-transition class="border-t border-gray-800 bg-black/50 p-2 space-y-2">
                            
                            <div class="text-[10px] text-gray-500 flex items-center gap-2 p-2">
                                <span>üè® Start:</span> <span class="text-white font-bold" x-text="hotels[day.hotelKey].name"></span>
                            </div>

                            <template x-for="(task, i) in day.tasks" :key="task.name">
                                <div class="bg-[#1a1a1a] rounded p-3 flex gap-3 items-start relative overflow-hidden group">
                                    
                                    <div class="flex-none w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs border transition-all mt-0.5"
                                         :class="isChecked(task.name) ? 'bg-neonCyan border-neonCyan text-black' : 'border-gray-600 text-gray-500'"
                                         x-text="i + 1">
                                    </div>

                                    <div class="flex-1 z-10">
                                        <div class="flex justify-between items-start">
                                            <div class="text-sm font-bold text-gray-200" :class="isChecked(task.name) ? 'line-through opacity-50' : ''" x-text="task.name"></div>
                                            <input type="checkbox" class="w-5 h-5 accent-neonCyan rounded cursor-pointer" 
                                                   :checked="isChecked(task.name)" @change="toggleCheck(task.name)">
                                        </div>
                                        <div class="text-[10px] text-neonCyan mt-1">üöá <span x-text="task.transport"></span></div>
                                        <div x-show="task.food" class="text-[10px] text-neonGold mt-1 italic">üçî <span x-text="task.food"></span></div>
                                        
                                        <a :href="task.coords ? `https://www.google.com/maps/dir/?api=1&destination=${task.coords[0]},${task.coords[1]}&travelmode=transit` : '#'" 
                                           target="_blank"
                                           class="mt-2 inline-block bg-gray-800 hover:bg-gray-700 px-3 py-1.5 rounded text-[10px] text-white font-bold border border-gray-600 transition-colors"
                                           x-show="task.coords">
                                           üìç NAWIGUJ
                                        </a>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

    </main>

    <nav class="flex-none bg-black border-t border-gray-800 pb-safe z-50 shadow-[0_-5px_15px_rgba(0,0,0,0.8)]">
        <div class="flex justify-around items-center h-16">
            
            <button @click="activeTab = 'dash'" class="flex flex-col items-center w-1/3 transition-all duration-300" :class="activeTab === 'dash' ? 'text-neonPurple scale-110' : 'text-gray-600'">
                <span class="text-2xl mb-1">üöÄ</span>
                <span class="text-[9px] font-bold tracking-widest">GAD≈ªETY</span>
            </button>

            <button @click="activeTab = 'plan'" class="flex flex-col items-center w-1/3 transition-all duration-300" :class="activeTab === 'plan' ? 'text-neonCyan scale-110' : 'text-gray-600'">
                <span class="text-2xl mb-1">üó∫Ô∏è</span>
                <span class="text-[9px] font-bold tracking-widest">PLAN & MAPA</span>
            </button>
            
            <button @click="resetTrip()" class="flex flex-col items-center w-1/3 text-gray-800 active:text-red-600 transition-colors">
                <span class="text-xl mb-1">üóëÔ∏è</span>
                <span class="text-[9px] font-bold tracking-widest">RESET</span>
            </button>
        </div>
    </nav>

    <script>
        function travelApp() {
            return {
                activeTab: 'dash', // Start od Dashboardu ≈ºeby zobaczyƒá licznik
                map: null,
                markers: [],
                routeLine: null,
                currentDayId: null,
                currentDayTitle: 'Wybierz dzie≈Ñ z listy',
                checked: JSON.parse(localStorage.getItem('jp_v7_checked')) || [],
                
                // GADGETS DATA
                yenInput: '',
                countdown: { days: 0, hours: 0 },
                todayDate: new Date().toLocaleDateString('pl-PL'),
                phrases: [
                    { pl: 'Dziƒôkujƒô', jp: 'Arigatou gozaimasu', pron: 'Arigato gozajmas' },
                    { pl: 'Przepraszam', jp: 'Sumimasen', pron: 'Sumimasen' },
                    { pl: 'Poproszƒô to', jp: 'Kore o kudasai', pron: 'Kore o kudasaj' },
                    { pl: 'Gdzie jest toaleta?', jp: 'Toire wa doko desu ka?', pron: 'Tojre ≈Ça doko deska' },
                    { pl: 'Dwa piwa', jp: 'Biru futatsu', pron: 'Biru futatsu' },
                    { pl: 'Rachunek poproszƒô', jp: 'O-kaikei onegaishimasu', pron: 'Okajke onegajshimas' }
                ],

                hotels: {
                    'galicia': { name: 'Galicia Ryogoku', coords: [35.6930, 139.7924] },
                    'lion': { name: 'Le Lion d\'or (Kioto)', coords: [35.0080, 135.7700] },
                    'tomi': { name: 'TOMI Hotel', coords: [35.6650, 139.8700] }
                },

                // PE≈ÅNA LISTA (Skr√≥cona dla czytelno≈õci kodu, ale logika ta sama co w V6)
                allDays: [
                    { 
                        id: 'd1', date: '23.03', title: 'ASAKUSA', hotelKey: 'galicia', colorClass: 'border-neonPink', totalKm: 0,
                        tasks: [
                            { name: 'Sens≈ç-ji Temple', coords: [35.7147, 139.7966], transport: 'Spacer', food: 'Melonpan' },
                            { name: 'Park Ueno', coords: [35.7140, 139.7740], transport: 'Metro Ginza', food: 'Street food Ameyoko' },
                            { name: 'Daikoku-yu Onsen', coords: [35.7077, 139.8056], transport: 'Taxi', food: 'Mleko kawowe' }
                        ]
                    },
                    {
                        id: 'd2', date: '24.03', title: 'CENTRUM', hotelKey: 'galicia', colorClass: 'border-neonPink', totalKm: 0,
                        tasks: [
                            { name: 'Tsukiji Market', coords: [35.6654, 139.7706], transport: 'Oedo Line', food: 'Sushi Daiwa' },
                            { name: 'Akihabara', coords: [35.7022, 139.7741], transport: 'Yamanote', food: 'Go Go Curry' }
                        ]
                    },
                    {
                        id: 'd3', date: '25.03', title: 'SHIBUYA (HARD)', hotelKey: 'galicia', colorClass: 'border-red-500', totalKm: 0,
                        tasks: [
                            { name: 'Shimokitazawa', coords: [35.6607, 139.6673], transport: 'Odakyu Line', food: 'Kawa & Curry' },
                            { name: 'Shibuya Crossing', coords: [35.6595, 139.7004], transport: 'Inokashira', food: 'Genki Sushi' },
                            { name: 'Shibuya Sky', coords: [35.6585, 139.7018], transport: 'Spacer', food: 'Widoki' }
                        ]
                    },
                    {
                        id: 'd4', date: '26.03', title: 'CHILL', hotelKey: 'galicia', colorClass: 'border-neonPink', totalKm: 0,
                        tasks: [
                            { name: 'Nakameguro', coords: [35.6443, 139.6990], transport: 'Hibiya Line', food: 'Truskawki i szampan' },
                            { name: 'Shinjuku Kabukicho', coords: [35.6938, 139.7035], transport: 'Yamanote', food: 'Yakitori na Omoide Yokocho' }
                        ]
                    },
                    {
                        id: 'd5', date: '27.03', title: 'WYCIECZKA', hotelKey: 'galicia', colorClass: 'border-neonGold', totalKm: 0,
                        tasks: [
                            { name: 'Kamakura (Budda)', coords: [35.3168, 139.5361], transport: 'JR Yokosuka', food: 'Lody batatowe' },
                            { name: 'Enoshima', coords: [35.3016, 139.4814], transport: 'Enoden', food: 'Ry≈º z rybkami' }
                        ]
                    },
                     {
                        id: 'd6', date: '28.03', title: 'KIOTO START', hotelKey: 'lion', colorClass: 'border-neonPurple', totalKm: 0,
                        tasks: [
                            { name: 'Kiyomizu-dera', coords: [34.9948, 135.7850], transport: 'Taxi', food: 'Ciastka Yatsuhashi' },
                            { name: 'Gion', coords: [35.0054, 135.7745], transport: 'Spacer', food: 'Matcha' }
                        ]
                    },
                    {
                        id: 'd7', date: '29.03', title: 'INARI', hotelKey: 'lion', colorClass: 'border-neonPurple', totalKm: 0,
                        tasks: [
                            { name: 'Fushimi Inari', coords: [34.9671, 135.7726], transport: 'Keihan Line', food: 'Kitsune Udon' }
                        ]
                    },
                    {
                        id: 'd9', date: '31.03', title: 'NARA', hotelKey: 'lion', colorClass: 'border-neonPurple', totalKm: 0,
                        tasks: [
                            { name: 'Nara Park', coords: [34.6850, 135.8430], transport: 'Kintetsu', food: 'Mochi (Nakatanidou)' }
                        ]
                    },
                    {
                        id: 'd10', date: '01.04', title: 'POWR√ìT', hotelKey: 'tomi', colorClass: 'border-neonCyan', totalKm: 0,
                        tasks: [
                            { name: 'TeamLab Planets', coords: [35.6154, 139.7956], transport: 'Yurikamome', food: 'Ramen' },
                            { name: 'Don Quijote', coords: null, transport: 'Wszƒôdzie', food: 'KitKat Wasabi' }
                        ]
                    }
                ],

                get convertedPln() {
                    if(!this.yenInput) return '0.00';
                    return (this.yenInput * 0.0265).toFixed(2) + ' z≈Ç';
                },

                get globalProgress() {
                    let total = 0; this.allDays.forEach(d => total += d.tasks.length);
                    if (total === 0) return 0;
                    return Math.round((this.checked.length / total) * 100);
                },

                initApp() {
                    // Start Countdown
                    this.updateCountdown();
                    setInterval(() => this.updateCountdown(), 60000);

                    // Calc Distances
                    this.calculateAllDistances();

                    // Init Map (Tylko je≈õli widoczna)
                    this.$watch('activeTab', value => {
                        if (value === 'plan' && !this.map) {
                            setTimeout(() => {
                                this.initMap();
                                this.focusDay(this.allDays[0]);
                                this.currentDayId = 'd1';
                            }, 100);
                        }
                    });
                },

                updateCountdown() {
                    const target = new Date('2026-03-22T20:00:00');
                    const now = new Date();
                    const diff = target - now;
                    if (diff > 0) {
                        this.countdown.days = Math.floor(diff / (1000 * 60 * 60 * 24));
                        this.countdown.hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    } else {
                        this.countdown = { days: 0, hours: 0 };
                    }
                },

                calculateAllDistances() {
                    this.allDays.forEach(day => {
                        const hotel = this.hotels[day.hotelKey];
                        let totalDist = 0;
                        let prevCoords = L.latLng(hotel.coords);
                        day.tasks.forEach(task => {
                            if(task.coords) {
                                const currCoords = L.latLng(task.coords);
                                totalDist += prevCoords.distanceTo(currCoords);
                                prevCoords = currCoords;
                            }
                        });
                        day.totalKm = totalDist > 0 ? (totalDist / 1000).toFixed(1) : null;
                    });
                },

                initMap() {
                    this.map = L.map('map', {zoomControl: false}).setView([35.6930, 139.7924], 12);
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                        attribution: '', maxZoom: 19
                    }).addTo(this.map);
                },

                focusDay(day) {
                    this.currentDayId = day.id;
                    this.currentDayTitle = day.title;
                    if(!this.map) return;

                    if (this.routeLine) this.map.removeLayer(this.routeLine);
                    this.markers.forEach(m => this.map.removeLayer(m));
                    this.markers = [];

                    const hotel = this.hotels[day.hotelKey];
                    const points = [hotel.coords]; 
                    
                    const hotelMarker = L.marker(hotel.coords, {
                        icon: L.divIcon({className: '', html: `<div class="hotel-icon">üè®</div>`, iconSize: [26,26]})
                    }).addTo(this.map);
                    this.markers.push(hotelMarker);

                    day.tasks.forEach((task, index) => {
                        if(task.coords) {
                            points.push(task.coords);
                            const marker = L.marker(task.coords, {
                                icon: L.divIcon({className: '', html: `<div class="number-icon">${index + 1}</div>`, iconSize: [24,24]})
                            }).addTo(this.map);
                            this.markers.push(marker);
                        }
                    });

                    if (points.length > 1) {
                        this.routeLine = L.polyline(points, {
                            color: '#00f2ff', weight: 4, opacity: 0.8
                        }).addTo(this.map);
                        this.map.flyToBounds(L.latLngBounds(points), { padding: [20, 20], duration: 0.8 });
                    }
                },

                isChecked(name) { return this.checked.includes(name); },
                toggleCheck(name) {
                    if (this.checked.includes(name)) this.checked = this.checked.filter(i => i !== name);
                    else {
                        this.checked.push(name);
                        if (navigator.vibrate) navigator.vibrate(50);
                    }
                    localStorage.setItem('jp_v7_checked', JSON.stringify(this.checked));
                },
                
                resetTrip() {
                    if(confirm("Czy≈õcimy wszystko?")) {
                        localStorage.removeItem('jp_v7_checked');
                        location.reload();
                    }
                }
            }
        }
    </script>
</body>
</html>

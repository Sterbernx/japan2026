<!DOCTYPE html>
<html lang="pl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <title>üáØüáµ JAPONIA V9 (FIXED)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        neonPink: '#ff0055',
                        neonCyan: '#00f2ff',
                        neonGreen: '#39ff14',
                        bgBlack: '#050505',
                        bgCard: '#111111'
                    },
                    fontFamily: {
                        'teko': ['Teko', 'sans-serif'],
                        'inter': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; -webkit-tap-highlight-color: transparent; }
        #map { height: 100%; width: 100%; background: #000; z-index: 1; }
        .leaflet-tile-pane { filter: invert(100%) hue-rotate(180deg) brightness(85%) contrast(110%); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Ikony */
        .number-icon {
            background: rgba(0,0,0,0.9); border: 2px solid #00f2ff; color: #00f2ff;
            border-radius: 50%; text-align: center; font-weight: 800; font-size: 16px; line-height: 28px;
        }
        .hotel-icon {
            background: #ff0055; border: 2px solid #fff; color: #fff;
            border-radius: 8px; text-align: center; font-size: 20px; line-height: 30px; z-index: 999;
        }
    </style>
</head>

<body class="h-screen flex flex-col overflow-hidden bg-bgBlack" x-data="travelApp()" x-init="initApp()">

    <header class="flex-none bg-bgCard border-b border-gray-800 p-3 flex justify-between items-center z-20 shadow-lg">
        <div>
            <h1 class="font-teko text-2xl tracking-widest text-white leading-none">JAPONIA V9</h1>
            <div class="text-[10px] text-gray-500 font-bold" x-text="clock"></div>
        </div>
        <div class="text-right">
             <div class="text-[9px] text-gray-400 font-bold uppercase">Do Wylotu</div>
             <div class="font-teko text-xl text-neonPink" x-text="countdown"></div>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto bg-black relative z-10 no-scrollbar pb-24">
        
        <div x-show="activeTab === 'dash'" class="p-4 space-y-4">
            
            <div class="grid grid-cols-2 gap-3">
                <button @click="switchTab('splitter')" class="bg-gray-900 border border-gray-700 p-4 rounded-xl flex flex-col items-center">
                    <span class="text-3xl mb-1">üí∏</span>
                    <span class="text-xs font-bold text-gray-300">ROZLICZ HAJS</span>
                </button>
                <button @click="switchTab('sos')" class="bg-gray-900 border border-gray-700 p-4 rounded-xl flex flex-col items-center">
                    <span class="text-3xl mb-1">üÜò</span>
                    <span class="text-xs font-bold text-gray-300">RATUNEK</span>
                </button>
            </div>

            <div class="bg-[#111] rounded-2xl p-5 border border-neonCyan/30">
                <h3 class="text-neonCyan font-bold mb-2 text-sm">üí¥ PRZELICZNIK</h3>
                <div class="flex gap-2 items-center">
                    <input type="number" x-model="yen" placeholder="JPY" class="w-full bg-black border border-gray-700 rounded p-3 text-white text-center">
                    <span class="text-gray-500">=</span>
                    <div class="w-full bg-gray-800 border border-gray-700 rounded p-3 text-neonGreen text-center font-bold" x-text="pln"></div>
                </div>
            </div>

            <div class="bg-[#111] rounded-2xl p-5 border border-gray-700">
                <h3 class="text-white font-bold mb-3 text-sm">üó£Ô∏è ROZM√ìWKI</h3>
                <div class="space-y-2">
                    <template x-for="p in phrases">
                        <div class="flex justify-between items-center border-b border-gray-800 pb-2">
                            <div>
                                <div class="text-sm font-bold" x-text="p.pl"></div>
                                <div class="text-[10px] text-gray-500 italic" x-text="p.pron"></div>
                            </div>
                            <button @click="speak(p.jp)" class="bg-gray-800 px-3 py-1 rounded text-xs border border-gray-600">üîä</button>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <div x-show="activeTab === 'plan'" class="flex flex-col h-full">
            <div class="flex-none relative bg-black z-0 h-[40vh] border-b border-gray-800 w-full">
                <div id="map"></div>
                <button @click="locate()" class="absolute bottom-2 right-2 z-[500] bg-black/80 p-2 rounded border border-white text-white text-xs">üìç Gdzie ja?</button>
            </div>

            <div class="flex-1 overflow-y-auto p-2 pb-24">
                <template x-for="(day, index) in allDays" :key="day.id">
                    <div class="mb-3 bg-bgCard rounded-xl border border-gray-800 overflow-hidden">
                        
                        <div @click="focusDay(day)" 
                             class="p-4 flex justify-between items-center cursor-pointer border-l-4"
                             :class="day.colorClass">
                            <div>
                                <div class="font-teko text-xl text-white" x-text="day.date"></div>
                                <div class="text-[10px] text-gray-400 font-bold uppercase" x-text="day.title"></div>
                            </div>
                            <div class="text-neonCyan">‚ñº</div>
                        </div>

                        <div x-show="currentDayId === day.id" class="border-t border-gray-800 bg-black/50 p-2 space-y-2">
                            <div class="text-[10px] text-gray-500 p-1">üè® Baza: <span class="text-neonPink font-bold" x-text="hotels[day.hotelKey].name"></span></div>

                            <template x-for="(task, i) in day.tasks" :key="task.name">
                                <div class="bg-[#1a1a1a] rounded p-3 border border-gray-800/50">
                                    <div class="flex justify-between items-start">
                                        <div class="flex gap-3">
                                            <div class="flex-none w-6 h-6 rounded-full flex items-center justify-center font-bold text-xs border border-gray-600 text-gray-400" x-text="i + 1"></div>
                                            <div>
                                                <div class="text-sm font-bold text-gray-200" :class="isChecked(task.name) ? 'line-through opacity-50' : ''" x-text="task.name"></div>
                                                <div class="text-[10px] text-neonCyan mt-1">üöá <span x-text="task.transport"></span></div>
                                            </div>
                                        </div>
                                        <input type="checkbox" class="w-5 h-5 accent-neonCyan rounded cursor-pointer" :checked="isChecked(task.name)" @change="toggleCheck(task.name)">
                                    </div>
                                    <div class="mt-2 flex gap-2" x-show="task.coords">
                                        <a :href="`https://www.google.com/maps/dir/?api=1&destination=${task.coords[0]},${task.coords[1]}&travelmode=transit`" target="_blank" 
                                           class="bg-gray-800 px-3 py-1 rounded text-[10px] text-white border border-gray-600">üìç Nawiguj</a>
                                        <div x-show="task.food" class="text-[10px] text-neonGold pt-1 italic ml-2">üçî <span x-text="task.food"></span></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <div x-show="activeTab === 'splitter'" class="p-4 space-y-4">
            <h2 class="font-teko text-3xl text-neonGreen">ROZLICZACZ üí∞</h2>
            <div class="bg-gray-900 p-4 rounded-xl border border-gray-700">
                <input x-model="expWho" placeholder="Kto? (np. Aleks)" class="w-full bg-black p-2 rounded border border-gray-600 text-sm mb-2 text-white">
                <input type="number" x-model="expAmount" placeholder="Ile? (JPY)" class="w-full bg-black p-2 rounded border border-gray-600 text-sm mb-2 text-white">
                <input x-model="expDesc" placeholder="Za co?" class="w-full bg-black p-2 rounded border border-gray-600 text-sm mb-2 text-white">
                <button @click="addExp()" class="w-full bg-neonGreen text-black font-bold py-2 rounded">DODAJ</button>
            </div>
            
            <div class="space-y-2">
                <template x-for="(e, i) in expenses">
                    <div class="flex justify-between items-center p-2 bg-[#111] rounded border border-gray-800 text-sm">
                        <span><b x-text="e.who"></b>: <span class="text-neonGreen" x-text="e.amount"></span> JPY</span>
                        <button @click="delExp(i)" class="text-red-500">‚úï</button>
                    </div>
                </template>
            </div>
        </div>

        <div x-show="activeTab === 'sos'" class="p-4 text-center space-y-6">
            <h2 class="font-teko text-4xl text-red-600 animate-pulse">POMOC üÜò</h2>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-red-900/20 border border-red-600 p-4 rounded-xl text-2xl font-bold text-white">110<div class="text-xs font-normal">POLICJA</div></div>
                <div class="bg-red-900/20 border border-red-600 p-4 rounded-xl text-2xl font-bold text-white">119<div class="text-xs font-normal">STRA≈ª/MED</div></div>
            </div>
            <div class="bg-white text-black p-4 rounded-xl text-left">
                <h3 class="font-bold border-b border-gray-300 mb-2">üöñ Dla Taks√≥wki</h3>
                <div class="text-lg font-bold">Koko made onegaishimasu:</div>
                <div class="bg-gray-100 p-2 mt-2 rounded border">
                    <b>Hotel Galicia Ryogoku</b><br>
                    4-31-6 Ryogoku, Sumida-ku, Tokyo
                </div>
            </div>
        </div>

    </main>

    <nav class="flex-none bg-black border-t border-gray-800 pb-safe z-50 h-16 flex justify-around items-center">
        <button @click="switchTab('dash')" :class="activeTab==='dash'?'text-white':'text-gray-600'" class="flex flex-col items-center w-1/4">
            <span class="text-xl">üè†</span><span class="text-[9px] font-bold">START</span>
        </button>
        <button @click="switchTab('plan')" :class="activeTab==='plan'?'text-neonCyan':'text-gray-600'" class="flex flex-col items-center w-1/4">
            <span class="text-xl">üó∫Ô∏è</span><span class="text-[9px] font-bold">MAPA</span>
        </button>
        <button @click="switchTab('splitter')" :class="activeTab==='splitter'?'text-neonGreen':'text-gray-600'" class="flex flex-col items-center w-1/4">
            <span class="text-xl">üí∏</span><span class="text-[9px] font-bold">HAJS</span>
        </button>
        <button @click="switchTab('sos')" :class="activeTab==='sos'?'text-red-500':'text-gray-600'" class="flex flex-col items-center w-1/4">
            <span class="text-xl">üÜò</span><span class="text-[9px] font-bold">SOS</span>
        </button>
    </nav>

    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        function travelApp() {
            return {
                activeTab: 'dash',
                map: null, markers: [], route: null,
                currentDayId: 'd1',
                clock: '', countdown: '',
                yen: '',
                checked: JSON.parse(localStorage.getItem('jp_v9_checked')) || [],
                
                // HAJS
                expenses: JSON.parse(localStorage.getItem('jp_v9_exp')) || [],
                expWho: '', expAmount: '', expDesc: '',

                hotels: {
                    'galicia': { name: 'Galicia Ryogoku', coords: [35.6930, 139.7924] },
                    'lion': { name: 'Le Lion d\'or', coords: [35.0080, 135.7700] },
                    'tomi': { name: 'TOMI Hotel', coords: [35.6650, 139.8700] }
                },

                phrases: [
                    { pl: 'Dziƒôki', jp: 'Arigatou', pron: 'Arigato' },
                    { pl: 'Przepraszam', jp: 'Sumimasen', pron: 'Sumimasen' },
                    { pl: 'To poproszƒô', jp: 'Kore o kudasai', pron: 'Kore o kudasaj' },
                    { pl: 'Gdzie toaleta?', jp: 'Toire wa doko?', pron: 'Tojre ≈Ça doko?' },
                    { pl: 'Piwo', jp: 'Biru', pron: 'Biru' }
                ],

                allDays: [
                    { id: 'd1', date: '23.03', title: 'ASAKUSA', hotelKey: 'galicia', colorClass: 'border-neonPink', tasks: [
                        { name: 'Sens≈ç-ji', coords: [35.7147, 139.7966], transport: 'Spacer', food: 'Melonpan' },
                        { name: 'Park Ueno', coords: [35.7140, 139.7740], transport: 'Ginza Line', food: 'Street food' },
                        { name: 'Daikoku-yu Onsen', coords: [35.7077, 139.8056], transport: 'Taxi', food: 'Mleko' }
                    ]},
                    { id: 'd2', date: '24.03', title: 'CENTRUM', hotelKey: 'galicia', colorClass: 'border-neonPink', tasks: [
                        { name: 'Tsukiji Market', coords: [35.6654, 139.7706], transport: 'Oedo Line', food: 'Sushi' },
                        { name: 'Akihabara', coords: [35.7022, 139.7741], transport: 'Yamanote', food: 'Maid Cafe' }
                    ]},
                    { id: 'd3', date: '25.03', title: 'WEST (HARD)', hotelKey: 'galicia', colorClass: 'border-red-500', tasks: [
                        { name: 'Gotokuji', coords: [35.6482, 139.6483], transport: 'Odakyu', food: '-' },
                        { name: 'Shibuya Crossing', coords: [35.6595, 139.7004], transport: 'Inokashira', food: 'Genki Sushi' },
                        { name: 'Shibuya Sky', coords: [35.6585, 139.7018], transport: 'Spacer', food: 'Widoki' }
                    ]},
                    { id: 'd4', date: '26.03', title: 'CHILL', hotelKey: 'galicia', colorClass: 'border-neonPink', tasks: [
                        { name: 'Nakameguro', coords: [35.6443, 139.6990], transport: 'Hibiya', food: 'Szampan' },
                        { name: 'Shinjuku', coords: [35.6938, 139.7035], transport: 'Yamanote', food: 'Yakitori' }
                    ]},
                    { id: 'd5', date: '27.03', title: 'TRIP', hotelKey: 'galicia', colorClass: 'border-neonCyan', tasks: [
                        { name: 'Kamakura', coords: [35.3168, 139.5361], transport: 'JR', food: 'Lody' },
                        { name: 'Enoshima', coords: [35.3016, 139.4814], transport: 'Enoden', food: 'Ryby' }
                    ]},
                    { id: 'd6', date: '28.03', title: 'KIOTO', hotelKey: 'lion', colorClass: 'border-neonPurple', tasks: [
                        { name: 'Kiyomizu-dera', coords: [34.9948, 135.7850], transport: 'Taxi', food: 'Yatsuhashi' },
                        { name: 'Gion', coords: [35.0054, 135.7745], transport: 'Spacer', food: 'Kaiseki' }
                    ]},
                    { id: 'd7', date: '29.03', title: 'INARI', hotelKey: 'lion', colorClass: 'border-neonPurple', tasks: [
                        { name: 'Fushimi Inari', coords: [34.9671, 135.7726], transport: 'Keihan', food: 'Udon' }
                    ]},
                    { id: 'd9', date: '31.03', title: 'NARA', hotelKey: 'lion', colorClass: 'border-neonPurple', tasks: [
                        { name: 'Nara Park', coords: [34.6850, 135.8430], transport: 'Kintetsu', food: 'Mochi' }
                    ]},
                    { id: 'd10', date: '01.04', title: 'POWR√ìT', hotelKey: 'tomi', colorClass: 'border-neonGreen', tasks: [
                        { name: 'TeamLab', coords: [35.6154, 139.7956], transport: 'Yurikamome', food: '-' },
                        { name: 'Zakupy', coords: null, transport: 'Wszƒôdzie', food: 'KitKat' }
                    ]}
                ],

                get pln() { return this.yen ? (this.yen * 0.027).toFixed(2) + ' z≈Ç' : '0.00'; },

                initApp() {
                    setInterval(() => {
                        const now = new Date();
                        this.clock = now.toLocaleTimeString('pl-PL', {hour:'2-digit', minute:'2-digit'});
                        const diff = new Date('2026-03-22T20:00:00') - now;
                        this.countdown = diff>0 ? Math.floor(diff/(1000*60*60*24)) + " DNI" : "TRIP!";
                    }, 1000);
                },

                switchTab(tab) {
                    this.activeTab = tab;
                    if(tab === 'plan') {
                        setTimeout(() => {
                            if(!this.map) this.initMap();
                            this.map.invalidateSize(); // TO NAPRAWIA MAPƒò!
                            this.focusDay(this.allDays[0]);
                        }, 100);
                    }
                },

                initMap() {
                    this.map = L.map('map', {zoomControl: false}).setView([35.693, 139.792], 12);
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {maxZoom:19}).addTo(this.map);
                },

                focusDay(day) {
                    this.currentDayId = day.id;
                    if(!this.map) return;
                    
                    this.markers.forEach(m => this.map.removeLayer(m));
                    if(this.route) this.map.removeLayer(this.route);
                    this.markers = [];
                    
                    const hotel = this.hotels[day.hotelKey];
                    const pts = [hotel.coords];
                    
                    this.markers.push(L.marker(hotel.coords, {icon: L.divIcon({html:'<div class="hotel-icon">üè®</div>', iconSize:[30,30]})}).addTo(this.map));

                    day.tasks.forEach((t, i) => {
                        if(t.coords) {
                            pts.push(t.coords);
                            this.markers.push(L.marker(t.coords, {icon: L.divIcon({html:`<div class="number-icon">${i+1}</div>`, iconSize:[28,28]})}).addTo(this.map));
                        }
                    });

                    if(pts.length > 1) {
                        this.route = L.polyline(pts, {color: '#00f2ff', weight: 4, opacity: 0.8}).addTo(this.map);
                        this.map.flyToBounds(L.latLngBounds(pts), {padding:[40,40]});
                    }
                },

                locate() {
                    if(navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(p => {
                            L.marker([p.coords.latitude, p.coords.longitude]).addTo(this.map).bindPopup("TY").openPopup();
                            this.map.setView([p.coords.latitude, p.coords.longitude], 14);
                        });
                    } else alert("W≈ÇƒÖcz GPS!");
                },

                speak(txt) {
                    const u = new SpeechSynthesisUtterance(txt);
                    u.lang = 'ja-JP';
                    window.speechSynthesis.speak(u);
                },

                addExp() {
                    if(this.expWho && this.expAmount) {
                        this.expenses.push({who: this.expWho, amount: this.expAmount, desc: this.expDesc});
                        this.expWho=''; this.expAmount=''; this.expDesc='';
                        localStorage.setItem('jp_v9_exp', JSON.stringify(this.expenses));
                    }
                },
                delExp(i) {
                    this.expenses.splice(i,1);
                    localStorage.setItem('jp_v9_exp', JSON.stringify(this.expenses));
                },

                isChecked(name) { return this.checked.includes(name); },
                toggleCheck(name) {
                    if(this.checked.includes(name)) this.checked = this.checked.filter(n=>n!==name);
                    else { this.checked.push(name); if(navigator.vibrate) navigator.vibrate(50); }
                    localStorage.setItem('jp_v9_checked', JSON.stringify(this.checked));
                }
            }
        }
    </script>
</body>
</html>

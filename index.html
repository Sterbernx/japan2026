<!DOCTYPE html>
<html lang="pl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <title> JAPONIA V6 MOBILE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        neonPink: '#ff0055',
                        neonCyan: '#00f2ff',
                        neonGold: '#ffd700',
                        bgBlack: '#000000',
                        bgCard: '#111111'
                    },
                    fontFamily: {
                        'teko': ['Teko', 'sans-serif'],
                        'inter': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; -webkit-tap-highlight-color: transparent; }
        
        /* Mapa zoptymalizowana pod mobile */
        #map { height: 35vh; width: 100%; z-index: 1; border-bottom: 2px solid #ff0055; }
        .leaflet-tile-pane { filter: invert(100%) hue-rotate(180deg) brightness(80%) contrast(120%); }
        
        /* Ukrywanie paska przewijania */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Ikony mapy */
        .number-icon {
            background: rgba(0,0,0,0.9); border: 2px solid #00f2ff; color: #00f2ff;
            border-radius: 50%; text-align: center; font-weight: 800; font-size: 16px; line-height: 28px;
        }
        .hotel-icon {
            background: #ff0055; border: 2px solid #fff; color: #fff;
            border-radius: 8px; text-align: center; font-size: 20px; line-height: 30px; z-index: 999;
        }
        .dist-badge {
            background: #000; border: 1px solid #00f2ff; color: #00f2ff; 
            font-size: 10px; padding: 2px 4px; border-radius: 4px; font-weight: bold;
        }
    </style>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>

<body class="h-screen flex flex-col overflow-hidden" x-data="travelApp()" x-init="initApp()">

    <div class="flex-none relative bg-black z-0">
        <div id="map"></div>
        <div class="absolute top-2 left-2 z-[500] bg-black/80 backdrop-blur px-3 py-1 rounded border border-gray-700 pointer-events-none">
            <div class="text-[10px] text-gray-400">AKTUALNY CEL:</div>
            <div class="text-neonCyan font-bold text-sm tracking-wide" x-text="currentDayTitle"></div>
        </div>
    </div>

    <main class="flex-1 overflow-y-auto bg-bgBlack relative z-10 no-scrollbar pb-24">
        
        <div x-show="activeTab === 'plan'">
            <template x-for="(day, index) in allDays" :key="day.id">
                <div class="mb-1 border-b border-gray-900">
                    
                    <div @click="focusDay(day)" 
                         class="sticky top-0 z-20 bg-bgCard/95 backdrop-blur-xl p-4 flex justify-between items-center border-l-4 transition-all active:scale-[0.98]"
                         :class="day.colorClass">
                        <div>
                            <div class="font-teko text-2xl leading-none" x-text="day.date"></div>
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] font-bold text-gray-400 tracking-widest uppercase" x-text="day.title"></span>
                                <span x-show="day.totalKm" class="text-[9px] bg-gray-800 text-gray-300 px-1.5 rounded border border-gray-700" x-text="day.totalKm + ' km'"></span>
                            </div>
                        </div>
                        <div class="p-2 bg-gray-800 rounded-full text-neonCyan">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0121 18.382V7.618a1 1 0 01-.854-.951l-4.22-2.11m0 0L9 7" /></svg>
                        </div>
                    </div>

                    <div x-show="currentDayId === day.id" x-transition class="p-3 space-y-3 bg-black">
                        
                        <div class="flex items-center gap-3 p-3 rounded bg-gray-900/50 border border-gray-800 text-gray-400 text-xs">
                            <span class="text-xl"></span>
                            <div>Start: <b class="text-neonPink" x-text="hotels[day.hotelKey].name"></b></div>
                        </div>

                        <template x-for="(task, i) in day.tasks" :key="task.name">
                            <div class="bg-bgCard rounded-xl p-3 border border-gray-800 relative shadow-lg">
                                <div class="flex gap-3">
                                    <div class="flex-none w-8 h-8 rounded-full flex items-center justify-center font-teko text-lg border-2 transition-colors"
                                         :class="isChecked(task.name) ? 'bg-neonCyan border-neonCyan text-black' : 'bg-transparent border-gray-600 text-gray-500'"
                                         x-text="i + 1">
                                    </div>

                                    <div class="flex-1">
                                        <div class="flex justify-between items-start">
                                            <div class="font-bold text-sm text-gray-100" x-text="task.name"></div>
                                            <input type="checkbox" class="w-6 h-6 accent-neonCyan rounded-full" 
                                                   :checked="isChecked(task.name)" @change="toggleCheck(task.name)">
                                        </div>

                                        <div class="mt-1 inline-block bg-gray-800 px-2 py-0.5 rounded text-[10px] text-neonCyan font-mono border border-gray-700">
                                             <span x-text="task.transport"></span>
                                        </div>

                                        <div x-show="task.food" class="mt-2 pt-2 border-t border-gray-800">
                                            <div class="flex items-start gap-2 text-[11px] text-neonGold">
                                                <span></span>
                                                <span class="italic" x-text="task.food"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <a :href="task.coords ? `https://www.google.com/maps/dir/?api=1&destination=${task.coords[0]},${task.coords[1]}&travelmode=transit` : '#'" 
                                   target="_blank"
                                   class="mt-3 block w-full bg-gray-800 active:bg-neonCyan active:text-black py-3 rounded-lg text-center text-xs font-bold text-gray-300 border border-gray-600 transition-colors flex items-center justify-center gap-2"
                                   :class="{'opacity-50 pointer-events-none': !task.coords}">
                                   <span> NAWIGUJ</span>
                                </a>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
        </div>

        <div x-show="activeTab === 'guide'" class="p-4 space-y-6">
            <h2 class="font-teko text-3xl text-neonGold text-center mb-4">SURVIVAL KIT </h2>
            
            <div class="space-y-4">
                <div class="bg-bgCard p-4 rounded-xl border border-neonPink">
                    <h3 class="text-neonPink font-bold mb-2 text-lg"> KONBINI (呕abka lvl 999)</h3>
                    <ul class="text-sm space-y-2 text-gray-300">
                        <li>オ <b>Egg Sandwich (Tamago Sando):</b> Absolutny hit na niadanie. 7-Eleven ma najlepsze.</li>
                        <li> <b>Famichiki:</b> Kurczak w panierce z FamilyMart. Tusty, idealny po alkoholu.</li>
                        <li> <b>Onigiri:</b> Kulki ry偶owe (Tuna Mayo to bezpieczna opcja).</li>
                    </ul>
                </div>

                <div class="bg-bgCard p-4 rounded-xl border border-neonCyan">
                    <h3 class="text-neonCyan font-bold mb-2 text-lg"> ALKOHOL (Dla Ziomk贸w)</h3>
                    <ul class="text-sm space-y-2 text-gray-300">
                        <li> <b>Strong Zero (9%):</b> Legendarny drink w puszce. 2 puszki = reset systemu. Kosztuje grosze.</li>
                        <li> <b>Highball:</b> Whisky z sod. Popularne w knajpach.</li>
                        <li> <b>Izakaya:</b> Japoski bar. Zamawiasz "Nomihoudai" (All you can drink) jak chcecie poszale.</li>
                    </ul>
                </div>

                <div class="bg-bgCard p-4 rounded-xl border border-neonGold">
                    <h3 class="text-neonGold font-bold mb-2 text-lg"> JEDZENIE (Klasyki)</h3>
                    <ul class="text-sm space-y-2 text-gray-300">
                        <li> <b>Coco Ichibanya:</b> Najlepsze tanie Curry. Wybierasz ostro (Level 2 to ju偶 piecze).</li>
                        <li> <b>Kura Sushi / Sushiro:</b> Tanie sushi na tamocigu. Talerzyki po 100 jen贸w.</li>
                        <li> <b>Ichiran Ramen:</b> Jesz w kabinie, zero kontaktu z lud藕mi. Pyszny bulion.</li>
                        <li> <b>Yoshinoya / Sukiya:</b> Miska ry偶u z woowin (Gyudon). Tanie i sycce.</li>
                    </ul>
                </div>
            </div>
        </div>

    </main>

    <nav class="flex-none bg-black border-t border-gray-800 pb-safe z-50">
        <div class="flex justify-around items-center h-16">
            <button @click="activeTab = 'plan'" class="flex flex-col items-center w-1/2 p-2 transition-colors" :class="activeTab === 'plan' ? 'text-neonCyan' : 'text-gray-500'">
                <span class="text-2xl mb-1"></span>
                <span class="text-[10px] font-bold tracking-widest">TRIP PLAN</span>
            </button>
            <button @click="activeTab = 'guide'" class="flex flex-col items-center w-1/2 p-2 transition-colors" :class="activeTab === 'guide' ? 'text-neonGold' : 'text-gray-500'">
                <span class="text-2xl mb-1"></span>
                <span class="text-[10px] font-bold tracking-widest">SURVIVAL</span>
            </button>
        </div>
    </nav>

    <script>
        function travelApp() {
            return {
                activeTab: 'plan',
                map: null,
                markers: [],
                routeLine: null,
                currentDayId: null,
                currentDayTitle: 'Wybierz dzie',
                checked: JSON.parse(localStorage.getItem('jp_v6_checked')) || [],
                
                hotels: {
                    'galicia': { name: 'Galicia Ryogoku', coords: [35.6930, 139.7924] },
                    'lion': { name: 'Le Lion d\'or (Kioto)', coords: [35.0080, 135.7700] },
                    'tomi': { name: 'TOMI Hotel', coords: [35.6650, 139.8700] }
                },

                allDays: [
                    { 
                        id: 'd1', date: '23.03 (Pon)', title: 'ASAKUSA & UENO', hotelKey: 'galicia', colorClass: 'border-neonPink', totalKm: 0,
                        tasks: [
                            { name: 'Sens-ji', coords: [35.7147, 139.7966], transport: 'Spacer / Bus', food: 'Kup "Melonpan" na straganie i wr贸偶b za 100 yen.' },
                            { name: 'Park Ueno', coords: [35.7140, 139.7740], transport: 'Metro Ginza', food: 'Ameyoko Market obok stacji - street food i tanie ciuchy.' },
                            { name: 'Yanaka Ginza', coords: [35.7275, 139.7645], transport: 'Spacer', food: 'Klimat starego Tokio. Zjedz krokieta misnego (Menchi-katsu).' },
                            { name: 'Daikoku-yu Onsen', coords: [35.7077, 139.8056], transport: 'Taxi', food: 'Zimne mleko kawowe po kpieli to obowizek.' }
                        ]
                    },
                    {
                        id: 'd2', date: '24.03 (Wt)', title: 'CENTRUM & AKIBA', hotelKey: 'galicia', colorClass: 'border-neonPink', totalKm: 0,
                        tasks: [
                            { name: 'Tsukiji Market', coords: [35.6654, 139.7706], transport: 'Oedo Line', food: 'niadanie Mistrz贸w: Sushi Daiwa albo omlet Tamagoyaki na patyku.' },
                            { name: 'Paac Cesarski', coords: [35.6851, 139.7527], transport: 'Hibiya Line', food: 'Tu nic nie ma, we藕cie wod.' },
                            { name: 'Caretta Shiodome', coords: [35.6649, 139.7626], transport: 'Spacer', food: 'Darmowy widok z windy na 46 pitro.' },
                            { name: 'Akihabara', coords: [35.7022, 139.7741], transport: 'Yamanote', food: 'Maid Cafe (dla beki) albo "Go Go Curry" (wielkie porcje).' }
                        ]
                    },
                    {
                        id: 'd3', date: '25.03 (r)', title: 'SHIBUYA & KOTY', hotelKey: 'galicia', colorClass: 'border-red-500', totalKm: 0,
                        tasks: [
                            { name: 'Gotokuji', coords: [35.6482, 139.6483], transport: 'Odakyu Line', food: 'Klasztor kot贸w. Tylko fotki.' },
                            { name: 'Shimokitazawa', coords: [35.6607, 139.6673], transport: 'Odakyu Line', food: 'Najlepsza kawa i mae knajpki z Curry.' },
                            { name: 'Shibuya Crossing', coords: [35.6595, 139.7004], transport: 'Inokashira Line', food: 'Genki Sushi (zamawiasz na tablecie).' },
                            { name: 'Harajuku / Meiji', coords: [35.6710, 139.7030], transport: 'Spacer', food: 'Naleniki (Crepes) na Takeshita Street.' }
                        ]
                    },
                    {
                        id: 'd4', date: '26.03 (Czw)', title: 'WINIE & GODZILLA', hotelKey: 'galicia', colorClass: 'border-neonPink', totalKm: 0,
                        tasks: [
                            { name: 'Nakameguro', coords: [35.6443, 139.6990], transport: 'Hibiya Line', food: 'Szampan z truskawkami nad rzek (drogo ale lans).' },
                            { name: 'Ikebukuro', coords: [35.7295, 139.7109], transport: 'Fukutoshin', food: 'Sunshine City - masa jedzenia.' },
                            { name: 'Shinjuku Kabukicho', coords: [35.6938, 139.7035], transport: 'Yamanote', food: 'Omoide Yokocho (Uliczka Sik贸w) - Yakitori i piwo. Klimat top.' }
                        ]
                    },
                    {
                        id: 'd5', date: '27.03 (Pt)', title: 'WYCIECZKA', hotelKey: 'galicia', colorClass: 'border-neonGold', totalKm: 0,
                        tasks: [
                            { name: 'Kamakura', coords: [35.3168, 139.5361], transport: 'JR Yokosuka', food: 'Lody o smaku batata (fioletowe).' },
                            { name: 'Enoshima', coords: [35.3016, 139.4814], transport: 'Enoden', food: 'Shirasu-don (ry偶 z maymi rybkami).' },
                            { name: 'Yokohama', coords: [35.4439, 139.6462], transport: 'Powr贸t', food: 'Chinatown: Piero偶ki gotowane na parze (ogromne).' }
                        ]
                    },
                    {
                        id: 'd6', date: '28.03 (Sob)', title: 'KIOTO START', hotelKey: 'lion', colorClass: 'border-neonPurple', totalKm: 0,
                        tasks: [
                            { name: 'Kiyomizu-dera', coords: [34.9948, 135.7850], transport: 'Taxi', food: 'Ciastka Yatsuhashi (cynamonowe tr贸jkty).' },
                            { name: 'Gion', coords: [35.0054, 135.7745], transport: 'Spacer', food: 'Drogo. Lepiej zje w okolicy rzeki Kamo.' }
                        ]
                    },
                    {
                        id: 'd7', date: '29.03 (Niedz)', title: 'INARI BRAMY', hotelKey: 'lion', colorClass: 'border-neonPurple', totalKm: 0,
                        tasks: [
                            { name: 'Fushimi Inari', coords: [34.9671, 135.7726], transport: 'Keihan Line', food: 'Uliczne 偶arcie przy wejciu (Kitsune Udon).' }
                        ]
                    },
                    {
                        id: 'd8', date: '30.03 (Pon)', title: 'KIOTO SPACER', hotelKey: 'lion', colorClass: 'border-neonPurple', totalKm: 0,
                        tasks: [
                            { name: 'Ginkaku-ji', coords: [35.0268, 135.7982], transport: 'Bus 17', food: 'Lody Matcha.' },
                            { name: 'cie偶ka Filozof贸w', coords: [35.0230, 135.7950], transport: 'Spacer', food: 'Kawiarnie po drodze.' }
                        ]
                    },
                    {
                        id: 'd9', date: '31.03 (Wt)', title: 'NARA', hotelKey: 'lion', colorClass: 'border-neonPurple', totalKm: 0,
                        tasks: [
                            { name: 'Nara Park', coords: [34.6850, 135.8430], transport: 'Kintetsu', food: 'Krakersy dla jeleni (nie jedzcie ich sami).' },
                            { name: 'Mochi Pounding', coords: [34.6833, 135.8290], transport: 'Nakatanidou', food: 'Najszybsze ubijanie Mochi w Japonii. Musisz spr贸bowa.' }
                        ]
                    },
                     {
                        id: 'd10', date: '01.04 - 05.04', title: 'TOKIO FINAL', hotelKey: 'tomi', colorClass: 'border-neonCyan', totalKm: 0,
                        tasks: [
                            { name: 'TeamLab Planets', coords: [35.6154, 139.7956], transport: 'Yurikamome', food: 'Ramen w Toyosu po zwiedzaniu.' },
                            { name: 'Zakupy / Donki', coords: null, transport: 'Wszdzie', food: 'KitKaty Wasabi i Sake.' }
                        ]
                    }
                ],

                initApp() {
                    this.map = L.map('map', {zoomControl: false}).setView([35.6930, 139.7924], 12);
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                        attribution: '&copy; CARTO', maxZoom: 19
                    }).addTo(this.map);
                    
                    this.calculateAllDistances();
                    setTimeout(() => {
                        this.currentDayId = 'd1'; 
                        this.focusDay(this.allDays[0]);
                    }, 500);
                },

                calculateAllDistances() {
                    this.allDays.forEach(day => {
                        const hotel = this.hotels[day.hotelKey];
                        let totalDist = 0;
                        let prevCoords = L.latLng(hotel.coords);
                        day.tasks.forEach(task => {
                            if(task.coords) {
                                const currCoords = L.latLng(task.coords);
                                totalDist += prevCoords.distanceTo(currCoords);
                                prevCoords = currCoords;
                            }
                        });
                        day.totalKm = totalDist > 0 ? (totalDist / 1000).toFixed(1) : null;
                    });
                },

                focusDay(day) {
                    this.currentDayId = day.id;
                    this.currentDayTitle = day.date + ' - ' + day.title;
                    
                    if (this.routeLine) this.map.removeLayer(this.routeLine);
                    this.markers.forEach(m => this.map.removeLayer(m));
                    this.markers = [];

                    const hotel = this.hotels[day.hotelKey];
                    const points = [hotel.coords]; 
                    
                    // Hotel Marker
                    const hotelMarker = L.marker(hotel.coords, {
                        icon: L.divIcon({className: '', html: `<div class="hotel-icon"></div>`, iconSize: [26,26]})
                    }).addTo(this.map);
                    this.markers.push(hotelMarker);

                    // Tasks
                    day.tasks.forEach((task, index) => {
                        if(task.coords) {
                            points.push(task.coords);
                            const marker = L.marker(task.coords, {
                                icon: L.divIcon({className: '', html: `<div class="number-icon">${index + 1}</div>`, iconSize: [24,24]})
                            }).addTo(this.map);
                            this.markers.push(marker);
                        }
                    });

                    // Line
                    if (points.length > 1) {
                        this.routeLine = L.polyline(points, {
                            color: '#00f2ff', weight: 4, opacity: 0.8
                        }).addTo(this.map);
                        this.map.flyToBounds(L.latLngBounds(points), { padding: [20, 20], duration: 0.8 });
                    }
                },

                isChecked(name) { return this.checked.includes(name); },
                toggleCheck(name) {
                    if (this.checked.includes(name)) this.checked = this.checked.filter(i => i !== name);
                    else {
                        this.checked.push(name);
                        if (navigator.vibrate) navigator.vibrate(50);
                    }
                    localStorage.setItem('jp_v6_checked', JSON.stringify(this.checked));
                }
            }
        }
    </script>
</body>
</html>

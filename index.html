<!DOCTYPE html>
<html lang="pl" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <title>JAPONIA V18 - HYBRID 3D</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'], hud: ['Rajdhani', 'sans-serif'] },
                    colors: { cyber: '#00f3ff', vip: '#ffd700', void: '#050505', panel: '#111' }
                }
            }
        }
    </script>
    
    <style>
        body { background: #000; color: #fff; overflow: hidden; }
        #map-container { position: fixed; top: 0; left: 0; width: 100%; height: 45vh; z-index: 0; border-bottom: 2px solid #00f3ff; }
        #map { width: 100%; height: 100%; background: #000; }
        #content-scroll { position: fixed; top: 45vh; left: 0; width: 100%; height: 55vh; overflow-y: auto; background: #050505; z-index: 10; padding-bottom: 80px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .pin-std { background: #000; color: #00f3ff; border: 2px solid #00f3ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; box-shadow: 0 0 15px rgba(0, 243, 255, 0.8); width: 28px; height: 28px; }
        .pin-star { background: #ffd700; color: #000; border: 2px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; box-shadow: 0 0 20px rgba(255, 215, 0, 1); width: 32px; height: 32px; z-index: 100; }
        .pin-hotel { font-size: 28px; filter: drop-shadow(0 0 10px #ff0055); text-align: center; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; }
    </style>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.js"></script>
</head>

<body x-data="app()" x-init="init()" class="h-screen w-screen bg-void text-white font-sans">

    <div id="map-container">
        <div id="map" wire:ignore></div>
        <div class="absolute top-3 left-3 z-[500] bg-black/80 backdrop-blur px-3 py-2 border-l-4 border-cyber pointer-events-none rounded-r-lg shadow-xl">
            <div class="text-[10px] text-gray-400 font-hud tracking-widest uppercase">AKTYWNY CEL</div>
            <div class="text-sm font-bold text-cyber font-hud text-lg leading-none" x-text="currentDayTitle"></div>
        </div>
        <button @click="locateMe()" class="absolute bottom-3 right-3 z-[500] bg-black/80 p-3 rounded-full border border-cyber text-cyber shadow-[0_0_15px_#00f3ff] active:scale-90 transition">üìç</button>
    </div>

    <div id="content-scroll">
        <div class="p-2 space-y-4">
            <template x-for="day in days" :key="day.id">
                <div class="bg-panel border border-gray-800 transition-all duration-300 rounded-lg overflow-hidden" :class="activeDay === day.id ? 'border-cyber shadow-[0_0_15px_rgba(0,243,255,0.1)]' : 'opacity-60'">
                    <div @click="setDay(day)" class="p-4 flex justify-between items-center cursor-pointer bg-gradient-to-r from-panel to-black">
                        <div>
                            <div class="font-hud text-2xl font-bold flex items-center gap-2">
                                <span x-text="day.date"></span>
                                <span x-show="day.hasNew" class="text-vip text-sm">‚≠ê</span>
                            </div>
                            <div class="text-[10px] text-gray-500 font-bold uppercase tracking-[0.2em]" x-text="day.title"></div>
                        </div>
                        <div class="text-cyber text-xl transition-transform" :class="activeDay === day.id ? 'rotate-90' : ''">‚û§</div>
                    </div>

                    <div x-show="activeDay === day.id" x-collapse class="border-t border-gray-800 bg-black/30">
                        <div class="p-3 bg-cyber/5 text-[11px] text-cyber border-b border-gray-800 font-mono italic">
                            üè® BAZA: <span x-text="hotels[day.hotelKey].name"></span>
                        </div>
                        <template x-for="(task, i) in day.tasks" :key="i">
                            <div class="border-b border-gray-800 last:border-0 transition-colors hover:bg-white/5" :class="task.isNew ? 'bg-vip/5 border-l-2 border-vip' : ''">
                                <div @click="toggleTask(day.id, i)" class="p-4 cursor-pointer">
                                    <div class="flex gap-4 items-center">
                                        <div class="flex-none w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold text-sm transition-all" 
                                             :class="task.isNew ? 'border-vip text-vip shadow-[0_0_10px_#ffd700]' : (task.expanded ? 'bg-cyber text-black border-cyber shadow-[0_0_10px_#00f3ff]' : 'border-gray-700 text-gray-500')">
                                            <span x-text="task.isNew ? '‚≠ê' : i+1"></span>
                                        </div>
                                        <div class="flex-1">
                                            <div class="font-bold text-sm text-gray-100" :class="task.isNew ? 'text-vip' : ''" x-text="task.name"></div>
                                        </div>
                                    </div>
                                </div>
                                <div x-show="task.expanded" class="bg-gray-900/80 px-4 pb-4 border-l-4 ml-4 mb-2" :class="task.isNew ? 'border-vip' : 'border-cyber'">
                                    <div class="mb-3 pt-2">
                                        <div class="text-[10px] font-bold uppercase tracking-widest mb-1" :class="task.isNew ? 'text-vip/80' : 'text-gray-400'">NOTATKI / DOJAZD</div>
                                        <div class="text-sm text-gray-200 leading-snug" x-text="task.desc"></div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button x-show="task.coords" @click.stop="nav(task.coords)" class="flex-1 text-black font-bold text-xs py-2 rounded transition shadow-lg active:scale-95" :class="task.isNew ? 'bg-vip' : 'bg-cyber'">üìç GOOGLE MAPS</button>
                                        <button x-show="task.food" @click.stop="alert('Tip: ' + task.food)" class="px-4 border font-bold text-xs py-2 rounded transition active:scale-95" :class="task.isNew ? 'border-vip text-vip' : 'border-vip text-vip'">üçî GASTRO</button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </template>
            <div class="h-20"></div>
        </div>
    </div>

    <script>
        function app() {
            return {
                map: null, currentMarkers: [], activeDay: 'd1', currentDayTitle: 'Przylot',
                hotels: {
                    tokyo1: { name: 'Galicia Ryogoku', coords: [139.7924, 35.6930] },
                    kyoto: { name: 'Le Lion d\'or', coords: [135.7700, 35.0080] },
                    tokyo2: { name: 'TOMI Hotel', coords: [139.8700, 35.6650] }
                },
                days: [
                    { id: 'd1', date: '22.03', title: 'PRZYLOT (TOKIO)', hotelKey: 'tokyo1', hasNew: false, tasks: [
                        { name: 'LƒÖdowanie NRT', coords: [140.3906, 35.7719], desc: 'Przylot ~20:00[cite: 2]. Odbierz Welcome Suica i wsiadaj w pociƒÖg Keisei[cite: 3].', expanded: false },
                        { name: 'Check-in Ryogoku', coords: [139.7924, 35.6930], desc: 'Wasza baza w Tokio[cite: 4]. Skocz do konbini po kurczaka i Stronga.', expanded: false }
                    ]},
                    { id: 'd2', date: '23.03', title: 'ASAKUSA & UENO', hotelKey: 'tokyo1', hasNew: true, tasks: [
                        { name: '‚≠ê Goshuincho dla Mamy!', coords: [139.7966, 35.7147], desc: 'Kup notes Goshuincho w Sens≈ç-ji[cite: 7]. To unikalny prezent ‚Äì kaligrafie z datami z ka≈ºdej ≈õwiƒÖtyni!', isNew: true, expanded: false },
                        { name: 'Sens≈ç-ji & Nakamise', coords: [139.7966, 35.7147], desc: 'Rano zwiedzanie ≈õwiƒÖtyni [cite: 7] i bazaru[cite: 8]. Zobacz Asahi [cite: 9] i park Sumida[cite: 10].', expanded: false },
                        { name: 'Ueno Park & Yanaka', coords: [139.7740, 35.7140], desc: 'Spacer przez Ueno [cite: 11] do Yanaka Ginza [cite: 12] i Nezu[cite: 13]. Wieczorem Onsen[cite: 14].', food: 'Krokiet Menchi Katsu w Yanaka.', expanded: false }
                    ]},
                    { id: 'd3', date: '24.03', title: 'TSUKIJI & AKIBA', hotelKey: 'tokyo1', tasks: [
                        { name: 'Tsukiji Market', coords: [139.7706, 35.6654], desc: '≈öniadanie na targu [cite: 17] i Hongan-ji[cite: 16]. Wagyu z grilla to mus!', food: 'Wagyu Skewer', expanded: false },
                        { name: 'Ogrody Cesarskie', coords: [139.7527, 35.6851], desc: 'Wschodnie ogrody [cite: 18] i spacer Marunouchi[cite: 19]. Panorama z Caretta Shiodome[cite: 20].', expanded: false },
                        { name: 'Akihabara', coords: [139.7741, 35.7022], desc: 'Centrum elektroniki i neonowy sza≈Ç wieczorem[cite: 21].', expanded: false }
                    ]},
                    { id: 'd4', date: '25.03', title: 'WEST TOKYO NIGHT', hotelKey: 'tokyo1', tasks: [
                        { name: 'Gotokuji & Shimokitazawa', coords: [139.6483, 35.6482], desc: 'Koty Maneki-neko [cite: 23] i hipsterskie Shimokitazawa[cite: 24].', expanded: false },
                        { name: 'Shibuya Crossing & Sky', coords: [139.7004, 35.6595], desc: 'Skrzy≈ºowanie [cite: 25] i Shibuya Sky[cite: 26]. Zr√≥b rezerwacjƒô!', expanded: false },
                        { name: 'Shinjuku Kabukicho', coords: [139.7035, 35.6938], desc: 'Godzilla, neony i Omoide Yokocho[cite: 28].', food: 'Kurczak Yakitori', expanded: false }
                    ]},
                    { id: 'd5', date: '26.03', title: 'HARAJUKU CHILL', hotelKey: 'tokyo1', tasks: [
                        { name: 'Meiji & Takeshita', coords: [139.6993, 35.6764], desc: '≈öwiƒÖtynia w lesie [cite: 30] i szale≈Ñstwo Harajuku[cite: 31, 32].', expanded: false },
                        { name: 'Nakameguro Hanami', coords: [139.6990, 35.6443], desc: 'Wi≈õnie nad kana≈Çem[cite: 34]. Wieczorem klimat jest nieziemski.', expanded: false }
                    ]},
                    { id: 'd6', date: '27.03', title: 'KAMAKURA & OCEAN', hotelKey: 'tokyo1', hasNew: true, tasks: [
                        { name: '‚≠ê Shonan Monorail', coords: [139.5312, 35.3534], desc: 'Dojazd do oceanu pociƒÖgiem wiszƒÖcym pod szynƒÖ! Kosmiczne wra≈ºenia.', isNew: true, expanded: false },
                        { name: 'Kamakura Budda', coords: [139.5361, 35.3168], desc: 'Wielki Budda [cite: 36], Hasedera [cite: 37] i Hachimangu[cite: 38].', expanded: false },
                        { name: 'Enoshima Sunset', coords: [139.4814, 35.3016], desc: 'Wyspa i zach√≥d s≈Ço≈Ñca nad oceanem[cite: 39, 40].', expanded: false }
                    ]},
                    { id: 'd7', date: '28.03', title: 'KIOTO WSCHODNIE', hotelKey: 'kyoto', tasks: [
                        { name: 'Shinkansen do Kioto', coords: [135.7588, 34.9858], desc: '2.5h pociƒÖgiem-pociskiem z Tokio[cite: 42].', expanded: false },
                        { name: 'Kiyomizu-dera & Gion', coords: [135.7850, 34.9948], desc: 'Drewniany taras [cite: 43], Sannenzaka [cite: 44] i dzielnica Gejsz[cite: 45, 46].', expanded: false }
                    ]},
                    { id: 'd8', date: '29.03', title: 'FUSHIMI INARI', hotelKey: 'kyoto', tasks: [
                        { name: 'Fushimi Inari', coords: [135.7726, 34.9671], desc: 'Bramy Torii bardzo wcze≈õnie rano[cite: 49]. Wideo call do Mamy ze szczytu!', expanded: false },
                        { name: 'Nishiki Market', coords: [135.7631, 35.0050], desc: 'Odpoczynek [cite: 50] i spacer po targu[cite: 52].', expanded: false }
                    ]},
                    { id: 'd10', date: '31.03', title: 'NARA JELONKI', hotelKey: 'kyoto', tasks: [
                        { name: 'Nara Park', coords: [135.8327, 34.6853], desc: 'Karmienie jelonk√≥w [cite: 60] i Todai-ji[cite: 61].', expanded: false }
                    ]},
                    { id: 'd11', date: '01.04', title: 'POWR√ìT TOKIO', hotelKey: 'tokyo2', tasks: [
                        { name: 'Shinkansen', coords: [139.7671, 35.6812], desc: 'Powr√≥t do bazy nr 2[cite: 64, 65].', expanded: false },
                        { name: 'Check-in TOMI', coords: [139.8700, 35.6650], desc: 'Ostatni hotel i chill[cite: 67, 68].', expanded: false }
                    ]},
                    { id: 'd12', date: '02.04', title: 'FUJI MISSION', hotelKey: 'tokyo2', hasNew: true, tasks: [
                        { name: '‚≠ê Fuji Excursion', coords: [138.7684, 35.4984], desc: 'Limitowany pociƒÖg pod samƒÖ G√≥rƒô Fuji do Kawaguchiko. Kadry ≈ºycia!', isNew: true, expanded: false }
                    ]},
                    { id: 'd13', date: '03-06.04', title: 'FINA≈Å & WYLOT', hotelKey: 'tokyo2', tasks: [
                        { name: 'TeamLab & Odaiba', coords: [139.7754, 35.6249], desc: 'Muzeum cyfrowe [cite: 72] i ostatnie zakupy[cite: 71].', expanded: false },
                        { name: 'Wylot NRT', coords: [140.3906, 35.7719], desc: 'Ostatnie spojrzenie na Skytree i pociƒÖg na lotnisko[cite: 74].', expanded: false }
                    ]}
                ],
                init() {
                    this.map = new maplibregl.Map({
                        container: 'map',
                        style: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json', 
                        center: [139.7924, 35.6930], zoom: 12, pitch: 60, attributionControl: false
                    });
                    this.map.on('load', () => { this.setDay(this.days[0]); });
                },
                setDay(day) {
                    this.activeDay = day.id; this.currentDayTitle = day.title;
                    this.currentMarkers.forEach(m => m.remove()); this.currentMarkers = [];
                    const bounds = new maplibregl.LngLatBounds();
                    const hotel = this.hotels[day.hotelKey];
                    const hLngLat = [hotel.coords[0], hotel.coords[1]];
                    
                    const hEl = document.createElement('div'); hEl.className = 'pin-hotel'; hEl.innerHTML = 'üè®';
                    const hMarker = new maplibregl.Marker({element: hEl}).setLngLat(hLngLat).addTo(this.map);
                    this.currentMarkers.push(hMarker); bounds.extend(hLngLat);

                    day.tasks.forEach((t, i) => {
                        if(t.coords) {
                            const lngLat = [t.coords[0], t.coords[1]];
                            const el = document.createElement('div'); 
                            el.className = t.isNew ? 'pin-star' : 'pin-std';
                            el.innerHTML = t.isNew ? '‚≠ê' : i + 1;
                            const marker = new maplibregl.Marker({element: el}).setLngLat(lngLat).addTo(this.map);
                            this.currentMarkers.push(marker); bounds.extend(lngLat);
                        }
                    });

                    // üöÄ DYNAMICZNY WIDOK:
                    // Obliczamy dystans (p√≥≈Çnoc-po≈Çudnie). Je≈õli > 50km, widok pionowy.
                    const dist = bounds.getNorth() - bounds.getSouth();
                    const targetPitch = dist > 0.5 ? 0 : 65; 

                    this.map.fitBounds(bounds, { padding: 60, speed: 1.2 });
                    setTimeout(() => {
                        this.map.easeTo({ pitch: targetPitch, duration: 800 });
                    }, 1000);
                },
                toggleTask(dayId, idx) { 
                    const day = this.days.find(d => d.id === dayId);
                    day.tasks.forEach((t, i) => { if(i !== idx) t.expanded = false; });
                    day.tasks[idx].expanded = !day.tasks[idx].expanded;
                },
                nav(coords) { 
                    // Poprawka wsp√≥≈Çrzƒôdnych dla Google Maps: Lat, Lng
                    window.open(`https://www.google.com/maps/dir/?api=1&destination=${coords[1]},${coords[0]}&travelmode=transit`, '_blank');
                },
                locateMe() {
                    if(navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(p => {
                            const lngLat = [p.coords.longitude, p.coords.latitude];
                            const el = document.createElement('div'); el.style.cssText='width:16px;height:16px;background:#39ff14;border-radius:50%;box-shadow:0 0 15px #39ff14;border:2px solid white;';
                            new maplibregl.Marker({element: el}).setLngLat(lngLat).addTo(this.map);
                            this.map.flyTo({center: lngLat, zoom: 15, pitch: 65});
                        });
                    }
                }
            }
        }
    </script>
</body>
</html>
